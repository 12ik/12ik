define("gondor/view/searchbar",["lib/jquery","mod/lang","mod/template","gondor/observer"],function(b,k,a,f){var c="<h6>检索中...</h6>",h,d=0,m=-1,g="",j;var n={init:function(p){var o=this;this.viewport=p.viewport;this.searchBox=p.box.click(function(q){h=true});this.searchList=this.searchBox.find(".search-list").click(function(r){var q=b(r.target);if(q.hasClass("link-node")||q.parent().hasClass("link-node")){o.clearInput()}});this.searchInput=this.searchBox.find(".text");this.searchInput.keyup(function(r){switch(r.which){case 13:var q=j;if(q&&q[0]){f.fire("node:guide",[q[0].href,q[0].title]);o.searchInput.blur();o.clearInput();o.hideSearchList()}else{o.search(this.value)}break;case 38:i(o.searchItems,true);break;case 40:i(o.searchItems);break;case 27:o.hideSearchList();break;default:if(this.value!==g){g=this.value;o.search(g)}break}});this.searchList.mouseover(function(q){if(q.target.nodeName==="A"){i(b(q.target))}})},search:function(o){clearTimeout(d);d=setTimeout(function(){f.fire("dashboard:search",[o,5])},400);this.searchList.html(c).show()},showSearchList:function(o,p){m=-1;j=null;this.searchList[0].innerHTML=a.convertTpl("tplSearchList",{lists:o,limit:p});this.searchItems=this.searchList.find(".link-node");this.viewport.click(l)},hideSearchList:function(){this.viewport.unbind("click",l);j=null;this.searchList.hide().html("")},focusSearch:function(){this.searchInput.focus()},showSearchBox:function(){this.searchBox.addClass("search-box-fastmode");b("body").click(e)},hideSearchBox:function(){this.searchBox.removeClass("search-box-fastmode");b("body").unbind("click",e)},clearInput:function(){this.searchInput.val("")}};function e(o){if(!h||o.button==2){n.hideSearchBox()}h=false}function l(){n.hideSearchList()}function i(q,p){if(!q){return}var o=q.length;if(o===1){m=-1}else{if(o){if(p){m--;if(m<0){m=o+m}}else{m++;if(m>=o){m=o-m}}q=q.eq(m)}}if(q){if(j){j.removeClass("on")}j=q;j.addClass("on")}}return n});