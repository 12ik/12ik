define("gondor/view/card",["lib/jquery","mod/lang","host","mod/template","mod/stick","gondor/observer","gondor/view/dialog"],function(d,l,m,b,e,h,g){var f='<div class="loading"></div>',k=m.document,a=true,j={citizen:{tmpl:"tplUserCard",namespace:"user"},place:{tmpl:"tplPlaceCard",namespace:"place"},node:{tmpl:"tplNodeCard",namespace:"node"},area:{tmpl:"tplAreaCard",namespace:"area"}};var c={showCard:function(q,o){o=o||{};var n=this,p=this.cardBox;if(!p){p=this.cardBox=d(k.body).append('<div class="gondor-card">'+f+"</div>").find(".gondor-card").click(function(r){if(r.target.getAttribute("target")!=="_blank"){a=false}})}else{if(this.cardEnabled){this.hideCard()}}p.show();e(q.nodeName?q:[q.left,q.top],p[0],o);h.wait("card:filled",function(){e(q.nodeName?q:[q.left,q.top],p[0],o)});setTimeout(function(){d(k).bind("click",i)},0);this.cardEnabled=true},fillCard:function(n,o){if(this.cardBox){this.cardBox.html(b.convertTpl(j[o].tmpl,n,j[o].namespace));h.fire("card:filled")}},hideCard:function(){if(this.cardBox){this.cardBox.hide().html(f);d(k).unbind("click",i);h.unbind("card:filled");this.cardEnabled=false}}};function i(n){if(a){c.hideCard()}a=true}return c});