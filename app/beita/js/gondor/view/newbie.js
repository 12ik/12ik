define("gondor/view/newbie",["lib/jquery","mod/lang","mod/template","mod/event","gondor/toolkit","gondor/observer","mod/domready"],function(c,r,d,t,a,l){var b=c(window),h=c("body"),e=c('<div class="newbie-wrapper"></div>'),n=c('<div class="newbie-mask"></div>'),u,i,p=[],m,j={tip_overview_map:function(){var w=g({"fullmap:close":x,"fullmap:open":v});m=w;function x(){s();k();w()}function v(){q();w()}},tip_detail_map:function(){var w=g({"fullmap:close":v,"fullmap:open":x});m=w;function v(){q();w()}function x(){s();k();w()}},tip_navigate_street:function(){var w=c(".toward.arrowS, .toward.arrowE").filter(function(E){var F=c(this).offset();return F.top<b.height()&&F.left<b.width()&&F.top>0&&F.left>0}),B=c(".dashboard"),z=e.find(".street-nav"),D=e.find(".map-nav"),C=w.offset().left,A;if(w.is(".arrowE")){A=C-200-60}else{A=C+120}z.css({left:A});D.css({top:B.offset().top+B.height()});var v=g({"fullmap:open":x,"walk:start":x,"place:enter":y,"folderWindow:enable":y});m=v;function x(){q();v()}function y(){s();k();v()}},tip_navigate_shop:function(){var w=g({"fullmap:open":x,"walk:start":v,"viewport:ready":x});m=w;function x(){s();k();w()}function v(){q();w()}},tip_settle_apartment:function(){var w=c(".node.vertical").find(".house").filter(function(){var A=c(this).offset();return A.top<b.height()&&A.left<b.width()&&A.top>0&&A.left>0}),x=e.find(".road-sign");if(w.length>0){x.css({left:w.offset().left-200})}var y=g({"fullmap:open":z,"walk:start":z,"place:enter":z,"soundDetail:open":z,"houseDetail:open":v});m=y;function z(){s();k();y()}function v(){q();y()}}};var f={init:function(w){var v=this;u=w.detailLayer;i=w.overviewLayer;this._showing=false;this.event=t();this.event.bind("finish:scene",function(){var x=p.shift();if(x===undefined){v._showing=false}else{x()}})},config:function(v){this.unread_tips=v.unread_tips},isUnreadTip:function(v){return this.unread_tips[v]},markAsShowed:function(v){this.unread_tips[v]=false},markAsUnread:function(v){this.unread_tips[v]=true},markAsRead:function(v,w){k();a.post(v,{tip:w});this.event.fire("finish:scene")},clear:function(){s();k();if(m){m()}},show:function(w,v){if(this._showing){o(x)}else{x()}this._showing=true;function x(){e.html(v).appendTo(h);if(j[w]){j[w]()}}}};function o(v){p.push(v)}function k(){f._showing=false;e.empty().remove()}function q(){var w=e.find(".newbie-done");if(!w.length){return}var v=w[0].href,x=w.data("tip");f.markAsRead(v,x)}function s(){var v=e.find(".newbie-done");if(!v.length){return}var w=v.data("tip");f.markAsUnread(w)}function g(w){for(var v in w){l.wait(v,w[v])}if(typeof(m)==="function"){m()}return function(){for(var x in w){l.cancel(x,w[x])}m=undefined}}return f});