define("gondor/view/sonorus",["lib/jquery","mod/lang","mod/template","mod/stick","gondor/observer","gondor/view/dialog","gondor/toolkit"],function(e,k,b,f,i,h,m){var g='<div class="loading"></div>',c='<div class="sonorus-box"><div class="hd"><h4>我的提醒</h4></div><div class="bd">'+g+"</div></div>",j='<div class="sonorus-cat"><div class="bd"><p>没有新的提醒</p></div><div class="ft"><a href="#kind=aprt" class="sonorus-more">全部提醒</a></div></div>',d="/api";var a={lock:false,limit:9,start:0,kind:"aprt",init:function(n){this.viewport=n.viewport;this.sonorusNum=n.num},unfold:function(){var n=this;if(!this.previewBox){this.previewBox=this.viewport.find(".sonorus-list").click(function(){n.lock=true})}var o=this.sonorusNum.parent().addClass("unfolded");this.previewBox.show();f(o[0],this.previewBox[0]);this.viewport.bind("click",l)},fold:function(){if(this.previewBox){this.previewBox.html(g).hide()}this.sonorusNum.parent().removeClass("unfolded")},update:function(o){var n=this,p=true;n.previewBox.html("");o.forEach(function(q){if(q.notifications.length){p=false;q.page=0;q.last=false;n.previewBox.append(b.convertTpl("tplSonorus",q))}});if(p){n.previewBox.append(j)}},updateNum:function(o){if(o){this.sonorusNum.html(o||0).show()}else{this.sonorusNum.hide()}},goTo:function(n){n=n||{};var o=h.body.find(".sonorus-box .bd").html(g);if(n.kind&&n.kind!=this.kind){this.kind=n.kind;this.start=0}m.get(d+"/notification",{kind:this.kind,start:this.start,limit:this.limit},function(p){o.html(p)})},prevPage:function(){this.start-=this.limit;this.goTo()},nextPage:function(){this.start+=this.limit;this.goTo()},open:function(n){this.start=0;h.set({isHideTitle:true,width:600,content:c,buttons:[]}).open();this.goTo(n)}};function l(){if(!a.lock){a.fold();a.viewport.unbind("click",l)}a.lock=false}return a});