define("mod/dialog",["lib/jquery","mod/lang","mod/browsers","mod/template","mod/event"],function(h,D,r,F,E){var d="dui-dialog",p=0,y=null,f=r.msie&&r.msie<7,c={},w={},b="dui-dialog",n="dui-dialog-close",v="dui-dialog-shd",q="dui-dialog-wrap",e="dui-dialog-shd2",t="dui-dialog-content",u="dui-mask",s="纭畾",a="鍙栨秷",z="鎻愮ず",m='<div class="dui-dialog-loading"></div>',k='<div id="{{id}}" class="{{css_dlg}}">                <div class="{{css_wrap}}">                    <span class="{{css_shd}}"></span>                    <div class="{{css_content}}">                        {{title}}                        <div class="dui-dialog-bd"></div>                    </div>                    {{bn_close}}                    <div class="dui-dialog-fb"></div>                </div>            </div>',g='<a href="#" class="'+n+'">X</a>',l='<div class="dui-dialog-hd"><h3>{{title}}</h3></div>',x='<div id="{{id}}" class="'+u+'" style="display:none;width:{{width}}px;height:{{height}}px;position:absolute;top:0;left:0;"></div>',A='<div class="dui-dialog-panel"><div class="shd"></div><div class="box"><div class="bd"></div><div class="ft"></div></div></div>',o={confirm:{text:s,method:function(G){G.close()}},cancel:{text:a,method:function(G){G.close()}}},C={url:"",iframeURL:"",content:"",title:z,width:0,height:0,customClassName:"",borderWidth:6,autoupdate:false,cache:true,buttons:[],callback:null,dataType:"text",eventTrace:0,eventStack:null,isTrueShadow:false,isHideMask:true,isHideClose:false,isHideTitle:false},j=function(J,I){var G={},H;for(H in I){if(I.hasOwnProperty(H)){G[H]=typeof J[H]!=="undefined"?J[H]:I[H]}}return G},B=function(L){var I=L.elements,H=0,J,K=[],G={"select-one":function(M){return encodeURIComponent(M.name)+"="+encodeURIComponent(M.options[M.selectedIndex].value)},"select-multiple":function(P){var O=0,N,M=[];for(;N=P.options[O++];){if(N.selected){M.push(encodeURIComponent(P.name)+"="+encodeURIComponent(N.value))}}return M.join("&")},radio:function(M){if(M.checked){return encodeURIComponent(M.name)+"="+encodeURIComponent(M.value)}},checkbox:function(M){if(M.checked){return encodeURIComponent(M.name)+"="+encodeURIComponent(M.value)}}};for(;J=I[H++];){if(G[J.type]){K.push(G[J.type](J))}else{K.push(encodeURIComponent(J.name)+"="+encodeURIComponent(J.value))}}return K.join("&").replace(/\&{2,}/g,"&")},i=function(G){var H=G||{};this.config=j(H,C);this.init()};i.prototype={init:function(){if(!this.config){return}this.event=E({trace:this.config.eventTrace,traceStack:this.config.eventStack});this.uuid=++p;this.render()},render:function(){var I=this.config,K=d+this.uuid,G=h("body");var H=h("#"+u+"_"+this.uuid);if(!H[0]){var J=h(window);H=h(F.format(x,{id:u+this.uuid,width:J.width(),height:J.height()}));H.appendTo(G)}G.append(F.format(k,{id:K,css_dlg:b+(I.customClassName?" "+I.customClassName:""),css_wrap:q,css_shd:I.isTrueShadow?e:v,css_content:t,title:F.format(l,{title:I.title}),bn_close:g}));this.id=K;this.node=h("#"+K);this.wrap=h("."+q,this.node);this.box=h("."+t,this.node);this.title=h(".dui-dialog-hd",this.node);this.body=h(".dui-dialog-bd",this.node);this.btnClose=h("."+n,this.node);this.shadow=h("."+(I.isTrueShadow?e:v),this.node);this.mask=H;this.set(I)},bind:function(){var M=this,G=h("body"),L=h(window);L.bind({resize:J,scroll:I});if(!M.config.isHideClose){this.btnClose.click(H);h(document).keyup(K);if(this.iframeContent){this.event.bind("frameOnload",function(){h(M.iframeWindow[0].document).keyup(K)});this.event.wait("close",function(){M.event.unbind("frameOnload")})}}this.unbind=function(){L.unbind({resize:J,scroll:I});if(!M.config.isHideClose){this.btnClose.unbind("click",H);h(document).unbind("keyup",K);if(this.iframeWindow){h(this.iframeWindow[0].document).unbind("keyup",K)}}};function J(){if(f){return}M.updatePosition();M.mask.css({width:L.width(),height:L.height()})}function I(){if(!f){return}M.updatePosition()}function K(N){if(N.keyCode===27){if(!({INPUT:1,TEXTAREA:1})[N.target.nodeName]){M.close()}}}function H(N){M.close();N.preventDefault()}},unbind:function(){},updatePosition:function(){var G=this.wrap.width(),I=this.wrap.height(),K=h(window),H=this.config.borderWidth,J=K.height()/2-I/2-H;if(J<=60){J=60}this.wrap.css({opacity:1,top:Math.floor(J)+"px",left:Math.floor(K.width()/2-G/2-H)+"px"})},loading:function(G){this.set(D.mix({content:m,width:400,buttons:[]},G||{})).open()},set:function(L){var N,P,H,I,G=this.id,J=[],K=this,O=function(Q){J.push(0);return G+"-"+Q+"-"+J.length};if(!L){return}if(L.width){this.wrap.css("width",L.width+"px");this.config.width=L.width}if(L.height){this.wrap.css("height",L.height+"px");this.config.height=L.height}if(h.isArray(L.buttons)&&L.buttons[0]){I=h(".dui-dialog-ft",this.node);H=[];h(L.buttons).each(function(){var R=arguments[1],Q=O("bn");if(typeof R==="string"&&o[R]){if(o[R].minor){H.push('<a class="lnk-flat '+d+"-bn-"+R+'" href="javascript:;" id="'+Q+'">'+o[R].text+"</a>")}else{H.push('<span class="bn-flat"><input type="button" id="'+Q+'" class="'+d+"-bn-"+R+'" value="'+o[R].text+'" /></span> ')}w[Q]=o[R].method}else{if(R.minor){H.push('<a class="lnk-flat '+d+'-bn" href="javascript:;" id="'+Q+'">'+R.text+"</a>")}else{H.push('<span class="bn-flat"><input type="button" id="'+Q+'" class="'+d+'-bn" value="'+R.text+'" /></span> ')}w[Q]=R.method}});if(!I[0]){I=this.body.parent().append('<div class="dui-dialog-ft">'+H.join("")+"</div>")}else{h(".dui-dialog-ft",this.node).unbind("click");I.html(H.join("")).show()}h(".dui-dialog-ft",this.node).click(function(R){var Q=w[R.target.id];if(Q){Q(K)}});this.footer=h(".dui-dialog-ft",this.node)}else{h(".dui-dialog-ft",this.node).hide().html("");this.footer=null}if(typeof L.isTrueShadow==="boolean"){if(L.isTrueShadow){this.shadow[0].className=e;this.config.borderWidth=0}else{this.shadow[0].className=v}this.config.isTrueShadow=L.isTrueShadow}if(typeof L.isHideClose==="boolean"){if(L.isHideClose){this.btnClose.hide()}else{this.btnClose.show()}this.config.isHideClose=L.isHideClose}if(typeof L.isHideTitle==="boolean"){if(L.isHideTitle){this.title.hide();this.box.addClass("notitle")}else{this.title.show();this.box.removeClass("notitle")}this.config.isHideTitle=L.isHideTitle}if(typeof L.isHideMask==="boolean"){this.config.isHideMask=L.isHideMask}if(L.title){this.setTitle(L.title);this.config.title=L.title}if(L.content){this.event.fire("setcontent",[this]);this.body.html(typeof L.content==="object"?h(L.content).html():L.content);this.iframeWindow=this.iframeContent=null;this.config.content=L.content}if(L.iframeURL){this.setFrameContent(L)}this.config.iframeURL=L.iframeURL;if(L.url){if(L.cache&&c[L.url]){if(L.dataType==="text"||!L.dataType){this.setContent(c[L.url])}if(L.callback){L.callback(c[L.url],this)}}else{if(L.dataType==="json"){this.setContent(m);if(this.footer){this.footer.hide()}h.getJSON(L.url,function(Q){if(K.footer){K.footer.show()}c[L.url]=Q;if(L.callback){L.callback(Q,K)}})}else{this.setContent(m);if(this.footer){this.footer.hide()}h.ajax({url:L.url,dataType:L.dataType,success:function(Q){c[L.url]=Q;if(K.footer){K.footer.show()}K.setContent(Q);if(L.callback){L.callback(Q,K)}}})}}}var M=L.position;if(M){this.wrap.css({left:M[0]+"px",top:M[1]+"px"})}if(typeof L.autoupdate==="boolean"){this.config.autoupdate=L.autoupdate}return this.update()},update:function(){this.updatePosition();return this},setContent:function(G){this.body.html(G);this.iframeWindow=this.iframeContent=null;return this.update()},setTitle:function(G){h("h3",this.title).html(G);return this},setFrameContent:function(G){var H=this;this.event.fire("setcontent",[this]);if(this.footer){this.footer.hide()}if(this.iframeContent){this.iframeContent.remove();this.iframeWindow=null}if(!G.content){this.setContent(m)}var I=+new Date();this.iframeContent=h('<iframe class="dui-dialog-iframebd" frameborder="0" scrolling="no" style="visibility:hidden;height:150px;"></iframe>').load(function(){H.iframeWindow=h(this.contentWindow);var J=+new Date()-I;setTimeout(function(){if(H.iframeContent){if(H.footer){H.footer.show()}H.iframeContent[0].style.visibility="";H.event.fire("frameOnload",[H]);H.body.find(".dui-dialog-loading").remove()}},J<600?J+400:0)});this.body[0].appendChild(this.iframeContent[0])},submit:function(I){var G=this,H=h("form",this.node);H.submit(function(M){M.preventDefault();var J=this.getAttribute("action",2),K=this.getAttribute("method")||"get",L=B(this);h[K.toLowerCase()](J,L,function(N){if(I){I(N)}},"json")});H.submit()},confirm:function(N,O,I){var Q=this,L=arguments;if(this.node[0].scrollTop){this.node.animate({scrollTop:0},400,"easeInOutQuint",function(){Q.confirm.apply(Q,L)});return}I=I||{};var H={confirm:I.confirmText||s,cancel:I.cancelText||a},K=this.box,G=K.find(".dui-dialog-panel");if(!G[0]){G=h(A).appendTo(K)}G.find(".bd")[0].innerHTML=N;var M=O&&["confirm","cancel"]||[I.cancelMethod?"cancel":"confirm"];G.find(".btn-confirm").remove();G.find(".btn-cancel").remove();G.find(".ft")[0].innerHTML=M.map(function(R){return'<span class="bn-flat"><input type="button" class="btn-'+R+'" value="'+H[R]+'" /></span>'}).join("");G.find(".btn-confirm").click(function(){Q.clearPanel(O)});G.find(".btn-cancel").click(function(){Q.clearPanel(I.cancelMethod)});G.show();var J=G.height(),P=K.width();G.find(".box").css({top:-J,left:P/4,width:P/2}).animate({top:0},400,"easeInOutQuint");Q.panelEnabled=true},clearPanel:function(G){var H=this.box.find(".dui-dialog-panel");if(H[0]){var I=this,J=H.height();H.find(".box").animate({top:-1000},400,"easeInOutQuint",function(){H.hide();H.find(".ft").find("input").remove();I.panelEnabled=false;if(G){G()}})}},open:function(){var I=this;this.wrap.css({opacity:0,top:h(window).height()/1.8+"px"});this.node.appendTo("body").show();if(this.config.iframeURL){this.iframeContent.attr("src",this.config.iframeURL)}if(!this.config.isHideMask){var K=h(window);if(r.msie&&r.msie<9){this.mask.show()}else{this.mask.clearQueue().stop().css({opacity:1,display:"block",width:K.width(),height:K.height()})}this.node.css({"z-index":6000})}if(this.enabled){this.unbind()}this.bind();var J=I.body[0],H=0,G=J.scrollHeight;if(this.config.autoupdate){var L=function(){clearTimeout(I._updateTimer);I._updateTimer=setTimeout(L,50);try{if(I.iframeWindow&&I.iframeContent){var N=I.iframeWindow[0].document.body.offsetHeight;if(N!==H){H=N;J.style.height="auto";I.iframeContent.css("height",N+"px")}}}catch(M){return}if(J.scrollHeight===G){return}G=J.scrollHeight;I.update()};L()}I.update();if(!this.enabled){this.event.fire("open",[this])}this.enabled=true;return this},close:function(){if(this.panelEnabled){var G=this;this.clearPanel(function(){G.close()});return this}this.node.hide();if(r.msie&&r.msie<9){this.mask.hide()}else{this.mask.fadeOut(400)}this.setContent(m);this.unbind();clearTimeout(this._updateTimer);h(window).focus();this.enabled=false;this.event.fire("close",[this]);return this}};return function(G,H){if(!H&&y){return G?y.set(G):y}if(!y&&!H){y=new i(G);return y}return new i(G)}});