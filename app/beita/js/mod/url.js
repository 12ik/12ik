define("mod/url",["mod/lang","mod/browsers"],function(p,g){var b=encodeURIComponent,j=decodeURIComponent,r=document,d=!!history.pushState,i=d?/(https?:\/\/.+?|^)\//:/.*?(?=#|$)/,h=d?/#.*/:/#!?\/?/,s=/([^&=\?]+)(=[^&=]*)/g,a=/.+#!?\/?/,q={win:window,base:"",autotidy:true},f={replace:false,route:true};function e(u,D,E){var B=Array.isArray(D)?D[0]:D;if(typeof B==="object"){for(var t in D){e(u,t,D[t])}}if(typeof B!=="string"){return false}var v=(d?"^":"^#!?")+(B&&B.replace(/\/?$/,"/?").replace(/:\w+/g,"([^/#\\?]+)")||"")+"(\\?.*|$)",A=u.match(new RegExp(v));if(!A){if(u!==B){return B!==D&&e(u,D.slice(1),E)||false}else{A=[""]}}var x={},z=A.pop().replace(/^\?/,"").split(/&/);for(var y=0,C,w=z.length;y<w;y++){C=z[y].split("=");if(C[0]){x[C[0]]=C[1]}}A[0]=x;E.apply(this,A);return true}function k(u){u=u.replace(i,"").replace(h,"");if(!u){return[{}]}u=u.split("/");var w,x={},v,z=u.pop(),y=/\?.*/;if(z){var t=z.replace(y,"");if(/\=/.test(z)){if(t&&y.test(z)){u.push(t)}while(w=s.exec(z)){x[w[1]]=w[2].substr(1)}}else{u.push(t);x={}}}else{x={}}u.unshift(x);return u}function c(w,u){w=Array.isArray(w)?w.slice():[w];var v=w.shift(),y=[];w=w.filter(function(z){return z!==""});for(var t in v){if(t){y.push(b(t)+"="+b(v[t]))}}var x=y.length?"?"+y.join("&"):"";if(u&&u.ending){w.push(x);return w.join("/")}else{return w.join("/")+x}}function n(u){var w=this.location;if(d){if(/#/.test(w.href)){var t=w.href.replace(this.base||this.domain,"");if(/#.*#/.test(t)){t=t.replace(/(.*?#.*?)#.*/,"$1")}t=t.replace(/^\/?#!?\/?/,"/");if(this.checkRules(t,this._route_config)){w.replace(t)}else{w.replace(w.href.replace(/#.*/,""))}}}else{var v="#!"+m.apply(this);if(this.checkRules(v,this._route_config)){this.load("/"+v,{replace:true})}else{if(/#.*#/.test(w.href)){w.replace(w.href.replace(/(.*?#.*?)#.*/,"$1"))}}}}function m(){return this.location.href.replace(this.base||this.domain,"").replace(/#.*/,"")}function l(){var t=this;this._route_config=[];this._hash_cache=false;this.handler=function(){var v=t.getHash();if(v===t._hash_cache){return}t._hash_cache=v;if(t.autotidy){n.call(t,t)}var u=t.checkRules(v,t._route_config);if(!u){t._defaultHandler.apply(t,t.parse(t.getHash()))}}}l.prototype={set:function(t){p.config(this,t||{},q);var u=this.location=this.win.location;this.domain=u.protocol+"//"+u.host;return this},listen:function(u){this.set(u);var t=this.win,v=r.documentMode;if(d){t.addEventListener("popstate",this.handler,false);setTimeout(this.handler,0)}else{if("onhashchange" in t&&(v===undefined||v>7)){if("addEventListener" in t){t.addEventListener("hashchange",this.handler,false)}else{t.attachEvent("onhashchange",this.handler)}setTimeout(this.handler,0)}else{this.timer=setInterval(this.handler,50)}}return this},stop:function(){this.win.removeEventListener("hashchange");clearInterval(this.timer);return this},route:function(t,u){if(t==="default"){this._defaultHandler=u}else{this._route_config.push([t,u])}return this},nav:function(t,H,u){var z,D,w,F=typeof t==="object",E=this.location,x=this.getHash(),C=this.parse(x),y=C.length;if(F){D=t;u=H}else{D={};D[t]=H}if(F||H!==undefined){z=C[0];var B=true;for(var A in D){B=false;t=A;H=D[A];w=parseInt(t,10);if(w!=t){if(false===H){delete z[t]}else{z[t]=H}}else{if(w>=0){if(false===H){if(C.length>w+1){C.length=w+1}}else{C[w+1]=H}}}}if(B){return}var G;if(d){G="/"+this.param(C,{ending:true})+E.hash}else{G=/#!?\/?/.exec(x)[0]+this.param(C)}this.load(G,u)}else{w=parseInt(t,10);if(w!=t){var I=C[0][t];return I&&j(I)}else{if(w>=0){return j(C[w+1])}}}},load:function(t,u){u=p.config({},u||{},f);if(d){if(u.replace){history.replaceState({},r.title,t)}else{history.pushState({},r.title,t)}if(u.route){setTimeout(this.handler,0)}else{this._hash_cache=t}}else{var w=this.location,v="/";if(/^\//.test(t)){t=t.replace(/^\//,"")}else{v=w.href.replace(/#.*/,"")}if(!u.route){this._hash_cache=t}if(u.replace){w.replace(v+t)}else{w.href=v+t}}},checkRules:function(u,v){var t;v.forEach(function(w){if(!t){t=e.apply(this,[u].concat(w))}});return t},parse:k,param:c};if(d){l.prototype.getHash=m}else{l.prototype.getHash=function(){return(/#/.test(this.location.href))?this.location.href.replace(a,"#!/"):"#!/"}}var o=function(u,t){return new l(u,t)};o.parse=k;o.param=c;o.SUPPORT_PUSHSTATE=d;return o});