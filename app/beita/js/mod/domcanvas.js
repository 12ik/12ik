define("mod/domcanvas",["mod/lang","mod/template","mod/browsers"],function(k,g,e){var f={globalAlpha:1,globalCompositeOperation:"source-over",fillStyle:"black",strokeStyle:"black",shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"black",font:"10px sans-serif",textAlign:"left",textBaseline:"bottom",_otherClass:""},h={},j=e.msie&&e.msie<9,a='<a href="{{href}}" class="domcanvas-sprite-rect{{otherClass}}" style="position:absolute;top:{{top}}px;left:{{left}}px;width:{{width}}px;height:{{height}}px;background-color:{{fillStyle}};{{opacity_style}}" {{bindData}}></a>',d='<img class="domcanvas-sprite-image{{otherClass}}" src="{{src}}" style="position:absolute;top:{{top}}px;left:{{left}}px;width:{{width}}px;height:{{height}}px;{{opacity_style}}" {{bindData}} />',c='<span class="domcanvas-sprite-text{{otherClass}}" style="position:absolute;top:{{top}};bottom:{{bottom}};left:{{left}};right:{{right}};{{width}};color:{{fillStyle}};font:{{font}};{{opacity_style}}" {{bindData}}>{{text}}</span>';function i(l){this.canvas=l;k.mix(this,f);this.pos=[0,0];this.buffer=[]}i.prototype={render:function(){this.canvas.appendChild(g.str2html(this.buffer.join("")));this.buffer=[]},translate:function(l,n){var m=this.pos;m[0]+=l;m[1]+=n},save:function(){var m=h;for(var l in f){m[l]=this[l]}m.pos=[this.pos[0],this.pos[1]]},restore:function(){var m=h;for(var l in f){this[l]=m[l]}this.pos[0]=m.pos[0];this.pos[1]=m.pos[1]},clearRect:function(l,o,m,n){this.canvas.innerHTML=""},fillRect:function(s,q,t,p){var r=this.pos,m=this.bindData,l=[];if(m){for(var n in m){l.push(n+'="'+m[n]+'" ')}}var o=g.format(a,{left:r[0]+s,top:r[1]+q,width:t,height:p,href:this._href||"javascript:;",bindData:l.join(""),otherClass:this._otherClass&&(" "+this._otherClass),opacity_style:b(this.globalAlpha),fillStyle:this.fillStyle});if(this.globalCompositeOperation=="source-over"){this.buffer.push(o)}else{this.buffer.unshift(o)}},fillText:function(w,u,s,v){var t=this.pos,m=t[0]+u,l=t[1]+s,q=this.bindData,o=[];if(q){for(var p in q){o.push(p+'="'+q[p]+'" ')}}var n={top:"auto",bottom:"auto",left:"auto",right:"auto",width:v?"width:"+v+"px;overflow:hidden;display:inline-block;":"",text:w,font:this.font,bindData:o.join(""),otherClass:this._otherClass&&(" "+this._otherClass),opacity_style:b(this.globalAlpha),fillStyle:this.fillStyle};if(this.textBaseline==="top"){n.top=l+"px"}else{n.bottom=this.canvas.offsetHeight-l+"px"}if(this.textAlign==="right"){n.right=this.canvas.offsetWidth-m+"px"}else{n.left=m+"px"}var r=g.format(c,n);if(this.globalCompositeOperation=="source-over"){this.buffer.push(r)}else{this.buffer.unshift(r)}},drawImage:function(m,t,r,u,q){var s=this.pos,o=this.bindData,l=[];if(o){for(var n in o){l.push(n+'="'+o[n]+'" ')}}var p=g.format(d,{src:m.src,left:s[0]+t,top:s[1]+r,width:u,height:q,bindData:l.join(""),otherClass:this._otherClass&&(" "+this._otherClass),opacity_style:b(this.globalAlpha)});if(this.globalCompositeOperation=="source-over"){this.buffer.push(p)}else{this.buffer.unshift(p)}}};function b(l){if(l==1){return""}return j?"filter:alpha(opacity="+(l*100)+");zoom:1;":"opacity:"+l+";"}return function(l){return new i(l)}});